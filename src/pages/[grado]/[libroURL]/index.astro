---
import Layout from "@/layouts/Layout.astro";
import { LIBROS_NEW } from "@/data/libros.js";
import Header from "@/components/Header.astro";
import InfoLibro from "@/components/InfoLibro.astro";

const { grado: gradoEnURL } = Astro.params;
const { libroURL } = Astro.params;

const informacionGrado = LIBROS_NEW.find(
    (gradoEnLista) => gradoEnLista.id === gradoEnURL
);

if (!gradoEnURL || !informacionGrado) return Astro.redirect("/404");

export async function getStaticPaths() {
    return informacionGrado?.libros.map((libroEnLista, i) => ({
        params: { libroURL: `libro-${libroEnLista.id}` },
    }));
}

const infoLibro = informacionGrado.libros.find(
    (libroEnLista) => `libro-${libroEnLista.id}` == libroURL
);

// Extraemos el género del libro
let textoGenero = "";
if (infoLibro) {
    if (infoLibro?.genero.length == 1) {
        textoGenero = infoLibro.genero[0];
    } else {
        infoLibro?.genero.forEach((generoEnLibro, index) => {
            index !== infoLibro.genero.length - 1
                ? (textoGenero += `${generoEnLibro} - `)
                : (textoGenero += `${generoEnLibro}`);
        });
    }
}
---

<Layout title={infoLibro.nombre}>
    <Header />
    <main>
        <section class="info">
            <div class="info-imagen">
                <picture>
                    <img
                        src={`/img/libros/${infoLibro.imagen_libro}.webp`}
                        alt={`Portada del libro ${infoLibro.nombre}`}
                        style={`view-transition-name: libro-${infoLibro.id}`}
                    />
                </picture>
            </div>
            <aside>
                <div class="info-general">
                    <h2 class="title-2">
                        {infoLibro.nombre}
                    </h2>
                    <p>{infoLibro.autor}</p>
                </div>
            </aside>
        </section>

        <section class="info-descripcion">
            <div>
                <InfoLibro titulo="Descripción" texto={infoLibro.descripcion} />
            </div>
            <div>
                <InfoLibro titulo="Editorial" texto={infoLibro.autor} />
                <InfoLibro titulo="Género(s)" texto={textoGenero} />
            </div>
            <div class="descargarLibro">
                <a href=`/libros/${infoLibro?.imagen_libro}.pdf` download>
                    Descargar Libro
                </a>
                <a
                    href=`/libros/${infoLibro?.imagen_libro}.pdf`
                    target="_blank"
                >
                    Leer Libro
                </a>
            </div>
        </section>
    </main>
</Layout>
